@page "/budget"
@using UI.Models;
@using UI.Models.ViewModels

<PageTitle> Hello in budget site</PageTitle>
<MudTabs Class="pa-4 ma-4" Elevation="5" Rounded="true" ApplyEffectsToContainer="true" PanelClass="pa-6" Centered="true" >
    <MudTabPanel Text="Transactions" >
        <MudStack  AlignItems="AlignItems.End">
            <MudStack Row="true">
                <MudStack>
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="AddTransaction" Class="mr-auto">
                        Add Transaction
                    </MudButton>
                </MudStack>
                <MudStack>
                    <MudButton Variant="Variant.Filled" Color="Color.Tertiary" OnClick="AddIncome" Class="ml-auto mr-5">
                        Add Income
                    </MudButton>
                </MudStack>
            </MudStack>
     
            <MudStack>
                <MudTooltip Placement="Placement.Left" ShowOnHover="true" Delay="150" Class="ma-1 mr-4 pa-2" RootStyle="width: 100%;">
                    <ChildContent>
                        <MudIcon Icon="@Icons.Material.Filled.Info" />
                    </ChildContent>
                    <TooltipContent> 
                        @if(patternViewModel.Id == 0)
                        {
                            <MudText Typo="Typo.body2"> No pattern</MudText>
                        }
                        else
                        {
                            <MudText Typo="Typo.body2">Pattern: @patternViewModel.Name</MudText>
                            <MudText Typo="Typo.body2">Saves: @patternViewModel.Value_Saves %</MudText>
                            <MudText Typo="Typo.body2">Fees: @patternViewModel.Value_Fees %</MudText>
                            <MudText Typo="Typo.body2">Entertainment: @patternViewModel.Value_Entertainment %</MudText>
                        }
                    </TooltipContent>
                </MudTooltip>
            </MudStack>
        </MudStack>

        <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.Center" Class="ma-1 pa-1 mt-2">
            <MudIconButton Icon="@Icons.Material.Filled.KeyboardDoubleArrowLeft" OnClick="PreviousMonth" Size="Size.Large"></MudIconButton>
            @CurrentDate.GetMonthName() @CurrentDate.Year
            <MudIconButton Icon="@Icons.Material.Filled.KeyboardDoubleArrowRight" OnClick="NextMonth" Size="Size.Large"></MudIconButton>
        </MudStack>

        <MudDropContainer T="TransactionViewModel"
                          Items="transactions"
                          ItemsSelector="@((item,dropzone) => Enum.GetName(typeof(TransactionCategoryEnum), item.Category) == dropzone)"
                          ItemDropped="ItemUpdated"
                          Class="d-flex flex-wrap flex-grow-1">
            <ChildContent>
                <UI.Components.BudgetTransactionDropZone 
                                Title="Saves" Identifier="Saves"
                                ActualValue="patternValuesModel.ActualValueSaves"
                                TotalValue="patternValuesModel.TotalValueSaves"
                                TitleColor="Color.Success" Color="forestgreen" />        
                <UI.Components.BudgetTransactionDropZone 
                                Title="Fees" Identifier="Fees"
                                ActualValue="patternValuesModel.ActualValueFees"
                                TotalValue="patternValuesModel.TotalValueFees"
                                TitleColor="Color.Error" Color="darkred" />            
                <UI.Components.BudgetTransactionDropZone 
                                Title="Entertainment" Identifier="Entertainment"
                                ActualValue="patternValuesModel.ActualValueEntertainment"
                                TotalValue="patternValuesModel.TotalValueEntertainment"
                                TitleColor="Color.Info" Color="dodgerblue" />
            </ChildContent>
            <ItemRenderer>
                <MudTooltip Placement="Placement.Bottom" ShowOnHover="true" Delay="150" Class="ma-4 pa-4" RootStyle="width: 100%;">
                    <ChildContent>
                        <MudPaper Elevation="25" Class="pa-2 my-2" @onclick="() => EditDeleteTransaction(context)">
                            <MudGrid>
                                <MudItem xs="8">
                                    <MudText Typo="Typo.body1">@context.Name</MudText>
                                </MudItem>
                                <MudItem xs="4" Class="text-align-right">
                                    <MudText Typo="Typo.body1">@context.Price</MudText>
                                </MudItem>
                            </MudGrid>
                        </MudPaper>
                    </ChildContent>
                    <TooltipContent>
                        <MudText Typo="Typo.body2">@context.Date.Format()</MudText>
                        <MudText Typo="Typo.body2">@context.Description</MudText>
                    </TooltipContent>
                </MudTooltip>
            </ItemRenderer>
        </MudDropContainer>
    </MudTabPanel>

    <MudTabPanel Text="Statistics"> 
        <UI.Components.StatisticsComponent />
    </MudTabPanel>

    <MudTabPanel Text="Tab3" Disabled="true">
        <MudText>Hidden message</MudText>
    </MudTabPanel>

</MudTabs>